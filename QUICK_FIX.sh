#!/bin/bash
# –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ projectFastapi..."
echo "================================"

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ë–î
echo "1Ô∏è‚É£  –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ë–î..."
rm -f kinovzor.db
echo "‚úÖ –ë–î —É–¥–∞–ª–µ–Ω–∞"

# –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π
echo "\n2Ô∏è‚É£  –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π..."
cd app
alembic downgrade base 2>/dev/null || echo "‚ö†Ô∏è  –ú–∏–≥—Ä–∞—Ü–∏–∏ —É–∂–µ –æ—Ç–∫–∞—á–µ–Ω—ã –∏–ª–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã"
cd ..
echo "‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –æ—Ç–∫–∞—á–µ–Ω—ã"

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π
echo "\n3Ô∏è‚É£  –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π..."
cd app
alembic upgrade head
cd ..
echo "‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã"

# –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
echo "\n4Ô∏è‚É£  –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ë–î —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏..."
python seed_db.py
echo "‚úÖ –ë–î –∑–∞–ø–æ–ª–Ω–µ–Ω–∞"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–µ–π
echo "\n5Ô∏è‚É£  –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–µ–π..."
python -c "from app.models import User, Movie, Review, Rating, Favorite; print('\n‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!')"

echo "\n================================"
echo "‚úÖ –í–°–ï –û–®–ò–ë–ö–ò –ò–°–ü–†–ê–í–õ–ï–ù–´!"
echo "================================"
echo "\nüöÄ –ò—Å–ø–æ–ª—å–∑—É–π:"
echo "   python -m uvicorn app.main:app --reload"
